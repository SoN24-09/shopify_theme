<div class="cate_leftmenu">
  <div class="filter-container">
    <h2 class="filter-title small-hide">商品を絞り込む</h2>
    <!-- 常にオープンの「ロットNoから年代検索」 -->
    <div class="filter-section small-hide">
      <div class="accordion open" data-toggle="section1">ロットNoから年代検索</div>
      <div class="panel open" id="section1">
        <div class="search-box">
          <form action="/search" method="get" role="search">
            <input type="text" name="q" class="search-input" placeholder="例：JA-128DOA">
            <button type="submit" class="search-button"></button>
          </form>
        </div>
        <p class="info-text"><a href="#">ロットNoについて</a></p>
      </div>
    </div>

    {% render 'facets',
      results: collection,
      enable_filtering: section.settings.enable_filtering,
      enable_sorting: section.settings.enable_sorting,
      filter_type: section.settings.filter_type,
      paginate: paginate
    %}

    {% render 'filter-by-category',mobile:false %}
  </div>
</div>
<script type="text/javascript">
  // メインアコーディオンの制御（常にオープンのセクションはスクリプト対象外）
  document.querySelectorAll('.accordion').forEach((div) => {
    div.addEventListener('click', () => {
      const panel = document.getElementById(div.dataset.toggle);
      const isOpen = panel.classList.contains('open');

      // 他のメインパネルを閉じる
      document.querySelectorAll('.panel').forEach((p) => p.classList.remove('open'));
      document.querySelectorAll('.accordion').forEach((b) => b.classList.remove('open'));

      // 選択されたパネルを切り替え
      if (!isOpen) {
        panel.classList.add('open');
        div.classList.add('open');
      }
    });
  });

  // サブカテゴリアコーディオンの制御
  document.querySelectorAll('.sub-accordion').forEach((div) => {
    div.addEventListener('click', () => {
      const subPanel = document.getElementById(div.dataset.toggle);
      subPanel.classList.toggle('open');
      div.classList.toggle('open');
    });
  });
</script>
